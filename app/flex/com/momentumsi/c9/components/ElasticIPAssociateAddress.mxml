<?xml version="1.0" encoding="utf-8"?>
<wizard:WizardWindow xmlns:fx="http://ns.adobe.com/mxml/2009" 
					 xmlns:s="library://ns.adobe.com/flex/spark" 
					 xmlns:mx="library://ns.adobe.com/flex/mx"
					 xmlns:wizard="com.momentumsi.c9.components.wizard.*"
					 title="Associate Address"
					 width="350" height="200" 
					 xmlns:services="com.momentumsi.c9.services.*">
	
	<fx:Script>
		<![CDATA[
			import com.momentumsi.c9.models.CloudAccount;
			import com.momentumsi.c9.utils.Helpers;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			[Bindable]
			public var instanceCollection:ArrayCollection = new ArrayCollection();
			[Bindable]
			public var address:String;
			
			protected function submitButton_clickHandler(event:MouseEvent):void
			{
				if(instanceSelection.selectedIndex != -1)
				{
					submitButton.enabled = false;
					ec2Service.instanceId = instanceSelection.selectedItem.id;
					ec2Service.associateAddress(address);
				}
			}
			
			protected function ec2Service_resultHandler(event:ResultEvent):void
			{
				Helpers.getObjectManagement(this).refreshResourceList();
				PopUpManager.removePopUp(this);
			}
			
			protected function ec2Service_faultHandler(event:FaultEvent):void
			{
				submitButton.enabled = true;
			}
			
			protected function instanceLabelFunction(item:Object):String
			{
				var label:String;
				if(item.name != null && item.name != "")
				{
					label = item.id + " (" + item.name + ")";
				}else
				{
					label = item.id;
				}
				return label;
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<services:Ec2Service id="ec2Service"
							 cloudAccountId="{cloudAccount.id}"
							 region="{region}"
							 result="ec2Service_resultHandler(event)"
							 fault="ec2Service_faultHandler(event)"/>
	</fx:Declarations>
	
	<s:VGroup width="100%" height="80%" paddingTop="10" paddingLeft="20" paddingRight="20" gap="20">
		<mx:Text text="Select the instance you wish to associate this IP address ({address})." width="100%"/>
		<s:HGroup>
			<mx:Text text="Instance:"/>
			<mx:ComboBox id="instanceSelection" dataProvider="{instanceCollection}" prompt="Select an instance" width="100%" labelFunction="{instanceLabelFunction}"/>
		</s:HGroup>
	</s:VGroup>
	<s:Button id="submitButton" x="96" y="136" label="Associate" click="submitButton_clickHandler(event)" enabled="{instanceSelection.selectedIndex != -1}"/>
	<s:Button id="cancelButton" x="184" y="136" label="Cancel" click="PopUpManager.removePopUp(this)"/>
</wizard:WizardWindow>
