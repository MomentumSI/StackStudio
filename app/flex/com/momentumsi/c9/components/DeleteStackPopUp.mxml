<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" width="400" height="200"
		 title="Delete Stack"
		 close="titlewindow1_closeHandler(event)"
		 creationComplete="creationCompleteHandler(event)" xmlns:services="com.momentumsi.c9.services.*">
	<fx:Script>
		<![CDATA[
			import com.momentumsi.c9.events.cloudFromation.CFServiceFaultEvent;
			import com.momentumsi.c9.events.cloudFromation.DeleteCFStackResultEvent;
			import com.momentumsi.c9.models.ProvisionedVersion;
			import com.momentumsi.c9.services.CloudApiService;
			import com.momentumsi.c9.utils.Helpers;
			
			import mx.controls.Alert;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.http.mxml.HTTPService;
			
			public var stack:ProvisionedVersion;
			[Bindable]
			public var cloudAccountId:String;
			[Bindable]
			public var region:String;
			
			protected function creationCompleteHandler(event:FlexEvent):void
			{
				PopUpManager.centerPopUp(this);
				stackName.text = stack.stackName;
			}
			
			protected function delete_clickHandler(event:MouseEvent):void
			{
				if(stack != null)
				{
					submitButton.enabled = false;
					deleteStackService.addEventListener(DeleteCFStackResultEvent.RESULT, deleteStack_resultHandler);
					deleteStackService.addEventListener(CFServiceFaultEvent.FAULT, deleteStack_faultHandler);
					deleteStackService.deleteStack(stackName.text);
				}
			}
			
			private function deleteStack_resultHandler(event:DeleteCFStackResultEvent):void
			{
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE));
			}
			
			private function deleteStack_faultHandler(event:CFServiceFaultEvent):void
			{
				
				Alert.show("Unable to delete stack, please try again later.");
				trace(event.message.toString());
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE));
			}
			
			protected function titlewindow1_closeHandler(event:CloseEvent):void
			{
				PopUpManager.removePopUp(this);
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		 <services:CloudFormationService id="deleteStackService"
										 cloudAccountId="{cloudAccountId}"
										 region="{region}"/>
	</fx:Declarations>
	
	
	<s:VGroup width="100%" height="85%" paddingTop="10" paddingLeft="20" paddingRight="20">
		<mx:Text width="100%" text="Deleting the stack will destroy all resources created in the stack. Are you sure you want to delete the following stack?"/>
		<mx:Text id="stackName" paddingLeft="15" width="100%"/>
	</s:VGroup>
	<s:Button id="submitButton" x="126" y="136" label="Delete" click="delete_clickHandler(event)"/>
	<s:Button x="203" y="136" label="Cancel" click="dispatchEvent(new CloseEvent(CloseEvent.CLOSE))"/>
</s:TitleWindow>
